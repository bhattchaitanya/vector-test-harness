#!/bin/bash
set -euo pipefail

# Init lib.
# shellcheck source=SCRIPTDIR/../lib/vector-test-harness/init.sh
source "$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)/../lib/vector-test-harness/init.sh"

#
# Usage
#

register_usage <<END
USAGE
   ssh host

DESCRIPTION
   SSHs onto the provided host using the same credentials that
   vector test harness ansible would use.

OPTIONS
   This command does not any specific options.
   All options are passed through to the ssh command.

EXAMPLES
   ./ssh 2.76.231.121
END

# Setup

OPTS=(
  -o "User=ubuntu"
)

if [[ -n "${VECTOR_TEST_PRIV_KEY:-""}" ]]; then
  OPTS+=(-o "IdentityFile=$VECTOR_TEST_PRIV_KEY")
  OPTS+=(-o "IdentitiesOnly=yes")
fi

# Execute

exec ssh "${OPTS[@]}" "$@"
